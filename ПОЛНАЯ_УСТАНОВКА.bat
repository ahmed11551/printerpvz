@echo off
chcp 65001 >nul
title Полная установка программы печати ячеек ПВЗ
color 0A
cls

echo.
echo ================================================
echo    ПОЛНАЯ УСТАНОВКА ПРОГРАММЫ ПЕЧАТИ ЯЧЕЕК ПВЗ
echo ================================================
echo.
echo Этот скрипт выполнит полную установку:
echo 1. Проверка и установка Python (если нужно)
echo 2. Установка зависимостей
echo 3. Создание ярлыков
echo 4. Установка расширения браузера
echo.
pause

:: ШАГ 1: Проверка Python
echo.
echo ================================================
echo ШАГ 1: ПРОВЕРКА PYTHON
echo ================================================
echo.
python --version >nul 2>&1
if errorlevel 1 (
    echo [ВНИМАНИЕ] Python не найден!
    echo.
    echo Варианты:
    echo 1. Установить Python вручную: https://www.python.org/downloads/
    echo 2. Использовать EXE версию (не требует Python)
    echo.
    set /p choice="Выберите вариант (1/2): "
    if "%choice%"=="1" (
        start https://www.python.org/downloads/
        echo.
        echo После установки Python запустите этот скрипт снова.
        pause
        exit /b 1
    ) else if "%choice%"=="2" (
        echo.
        echo Используйте EXE версию. Запустите СОЗДАТЬ_EXE.bat для создания.
        pause
        exit /b 0
    )
) else (
    python --version
    echo [OK] Python установлен
)

:: ШАГ 2: Установка зависимостей
echo.
echo ================================================
echo ШАГ 2: УСТАНОВКА ЗАВИСИМОСТЕЙ
echo ================================================
echo.
echo Установка зависимостей Python...
python -m pip install --quiet --upgrade pip >nul 2>&1
python -m pip install --quiet -r requirements.txt
if errorlevel 1 (
    echo [ОШИБКА] Не удалось установить зависимости
    pause
    exit /b 1
)
echo [OK] Зависимости установлены

:: ШАГ 3: Создание ярлыков
echo.
echo ================================================
echo ШАГ 3: СОЗДАНИЕ ЯРЛЫКОВ
echo ================================================
echo.
if not exist "ЗАПУСТИТЬ.bat" (
    (
        echo @echo off
        echo cd /d "%%~dp0"
        echo python server.py
        echo pause
    ) > ЗАПУСТИТЬ.bat
    echo [OK] Ярлык запуска создан
) else (
    echo [OK] Ярлык запуска уже существует
)

:: ШАГ 4: Установка расширения
echo.
echo ================================================
echo ШАГ 4: УСТАНОВКА РАСШИРЕНИЯ БРАУЗЕРА
echo ================================================
echo.
if exist "УСТАНОВИТЬ_РАСШИРЕНИЕ.bat" (
    set /p install_ext="Установить расширение сейчас? (Y/N): "
    if /i "%install_ext%"=="Y" (
        call "%~dp0УСТАНОВИТЬ_РАСШИРЕНИЕ.bat"
    ) else (
        echo.
        echo Вы можете установить расширение позже, запустив УСТАНОВИТЬ_РАСШИРЕНИЕ.bat
    )
) else (
    echo [ВНИМАНИЕ] Скрипт установки расширения не найден
    echo Установите расширение вручную (см. README.md)
)

:: ИТОГ
echo.
echo ================================================
echo           УСТАНОВКА ЗАВЕРШЕНА!
echo ================================================
echo.
echo ЧТО ДАЛЬШЕ:
echo.
echo 1. Настройте принтер:
echo    - Откройте config.json
echo    - Укажите порт принтера (COM3, /dev/ttyUSB0 и т.д.)
echo.
echo 2. Запустите сервер:
echo    - Двойной клик на ЗАПУСТИТЬ.bat
echo.
echo 3. Установите расширение (если еще не установили):
echo    - Запустите УСТАНОВИТЬ_РАСШИРЕНИЕ.bat
echo.
echo ================================================
echo.
pause

