# Печать этикеток ячеек ПВЗ

Утилита для автоматической печати номеров ячеек на термопринтер при работе с системами:
- Турбо-ПВЗ (Ozon)
- ВВПВЗ (Wildberries)

## Возможности

- Автоматическое обнаружение номеров ячеек на страницах приемки
- Печать на термопринтер с поддержкой ESC/POS
- Поддержка различных типов принтеров (Serial, USB, Network)
- Печать QR-кода с номером ячейки
- Браузерное расширение для Chrome, Яндекс.Браузера и Edge
- Гибкие настройки печати

## Поддерживаемые платформы

- Windows
- macOS
- Linux

## Требования

**ВНИМАНИЕ: Для работы программы требуется Python 3.7 или выше.**

Если Python не установлен:

**Windows:**
1. Скачайте Python с [python.org](https://www.python.org/downloads/)
2. При установке **обязательно отметьте** "Add Python to PATH"
3. Перезагрузите компьютер после установки

**macOS:**
```bash
brew install python3
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install python3 python3-pip
```

## Установка

### Windows

1. **Убедитесь, что Python установлен** (запустите `python --version` в командной строке)
2. Запустите `УСТАНОВКА.bat` (двойной клик)
3. Запустите сервер одним из способов:
   - `ЗАПУСТИТЬ.bat` - запуск сервера в консоли
   - `ЗАПУСТИТЬ_GUI.bat` - запуск с графическим интерфейсом

### macOS / Linux

1. **Убедитесь, что Python3 установлен** (запустите `python3 --version` в терминале)
2. Запустите установку:
   ```bash
   chmod +x УСТАНОВКА.sh
   ./УСТАНОВКА.sh
   ```

3. Запустите сервер:
   ```bash
   ./ЗАПУСТИТЬ.sh
   ```

### Установка зависимостей вручную

```bash
pip install -r requirements.txt
```

Для macOS может потребоваться:
```bash
brew install libusb
```

Для Linux может потребоваться:
```bash
sudo apt-get install libusb-1.0-0-dev
```

## Настройка принтера

Откройте файл `config.json` и настройте параметры вашего принтера:

### Для Serial принтера (через COM-порт):

**Windows:**
```json
{
  "type": "serial",
  "serial_port": "COM3",
  "serial_baudrate": 9600
}
```

**macOS:**
```json
{
  "type": "serial",
  "serial_port": "/dev/tty.usbserial-*",
  "serial_baudrate": 9600
}
```

**Linux:**
```json
{
  "type": "serial",
  "serial_port": "/dev/ttyUSB0",
  "serial_baudrate": 9600
}
```

### Для USB принтера:
```json
{
  "type": "usb",
  "vendor_id": 1200,
  "product_id": 8258
}
```

### Для сетевого принтера:
```json
{
  "type": "network",
  "network_host": "192.168.1.100",
  "network_port": 9100
}
```

## Запуск сервера

Сервер запустится на `http://localhost:5001`

### Windows:
- Двойной клик на `ЗАПУСТИТЬ.bat` - запуск в консоли
- Двойной клик на `ЗАПУСТИТЬ_GUI.bat` - запуск с графическим интерфейсом

### macOS / Linux:
```bash
./ЗАПУСТИТЬ.sh
```

Или напрямую:
```bash
python3 server.py
```

## Установка браузерного расширения

### Chrome
1. Откройте `chrome://extensions/`
2. Включите "Режим разработчика"
3. Нажмите "Загрузить распакованное расширение"
4. Выберите папку `extension` (где находится `manifest.json`)

### Яндекс.Браузер
1. Откройте `browser://extensions/` или меню → Дополнения → Управление дополнениями
2. Включите "Режим разработчика"
3. Нажмите "Загрузить распакованное расширение"
4. Выберите папку `extension` (где находится `manifest.json`)

### Edge
1. Откройте `edge://extensions/`
2. Включите "Режим разработчика"
3. Нажмите "Загрузить распакованное расширение"
4. Выберите папку `extension` (где находится `manifest.json`)

Подробная инструкция: `extension/README_РАСШИРЕНИЕ.txt`

## Как это работает

### Принцип работы

**ВАЖНО:** Приложение использует прямое чтение данных из DOM страницы (НЕ OCR распознавание текста).

1. **Менеджер сканирует штрих-код товара сканером**
   - Сканер отправляет данные в систему Ozon/Wildberries
   - Система обрабатывает данные и **записывает номер ячейки в DOM страницы**

2. **Расширение автоматически обнаруживает изменения**
   - Использует MutationObserver для отслеживания изменений DOM в реальном времени
   - Находит номер ячейки в структуре HTML (input поля, текстовые элементы, атрибуты)
   - Автоматически отправляет на печать

3. **Сервер печатает этикетку**
   - Получает номер ячейки
   - Формирует команды ESC/POS для принтера
   - Печатает этикетку с номером ячейки и QR-кодом

**Форматы номеров ячеек:**
- Один товар: `122`
- Два товара: `122-1`, `122-2`
- Три товара: `122-1`, `122-2`, `122-3`
- И так далее по возрастанию

**Время от сканирования до печати:** ~1-3 секунды

## Использование

### Автоматическая печать

**ВАЖНО:** Работает только при сканировании через браузер на компьютере (не работает с мобильными приложениями).

1. Убедитесь, что сервер печати запущен
2. Откройте страницу приемки в Турбо-ПВЗ или ВВПВЗ **в браузере на компьютере**
3. Подключите сканер к компьютеру
4. Сканируйте товары сканером
5. Номера ячеек **автоматически** обнаруживаются и отправляются на печать
6. Принтер печатает этикетки с номерами ячеек и QR-кодами

**Подробнее о работе с мобильными приложениями:** `МОБИЛЬНОЕ_ПРИЛОЖЕНИЕ.md`

### Тестовая печать

1. Кликните на иконку расширения в браузере
2. Введите номер ячейки в поле "Тестовая ячейка"
3. Нажмите "Печать тестовой ячейки"

### Настройки расширения

В popup расширения можно:
- Включить/выключить автопечать
- Изменить URL сервера печати (если сервер на другом компьютере)

## Технические детали

- Протокол печати: ESC/POS
- **Размер этикетки: 58×40 мм** (соответствует стандарту Wildberries и Ozon FBS)
- Поддерживаемые принтеры: любые термопринтеры с поддержкой ESC/POS (58мм или 80мм)
- Настройки размера: можно изменить в `config.json` (параметры `width_mm` и `label_height_mm`)
  - Epson TM-T20, TM-T82, TM-T88
  - Star Micronics TSP100, TSP650
  - Zebra GC420d, ZD220
  - И другие

## Структура проекта

```
.
├── server.py              # Сервер для печати
├── app_gui.py             # GUI приложение
├── config.json            # Конфигурация принтера
├── requirements.txt       # Python зависимости
├── server.spec            # Конфигурация для создания EXE
├── extension/             # Папка расширения браузера
│   ├── manifest.json
│   ├── content.js
│   ├── popup.html/js
│   ├── background.js
│   ├── icons/
│   └── README_РАСШИРЕНИЕ.txt
├── УСТАНОВКА.bat/sh       # Скрипты установки
├── ЗАПУСТИТЬ.bat/sh       # Скрипты запуска
├── ЗАПУСТИТЬ_GUI.bat/sh   # Скрипты запуска GUI
├── УСТАНОВИТЬ_РАСШИРЕНИЕ.bat/sh  # Установка расширения
├── СОЗДАТЬ_EXE.bat        # Создание EXE
└── README.md              # Документация
```

## Графический интерфейс (GUI)

Для удобства управления доступно GUI приложение:

**Запуск:**
- Windows: `ЗАПУСТИТЬ_GUI.bat`
- Mac/Linux: `./ЗАПУСТИТЬ_GUI.sh`

**Возможности GUI:**
- Запуск/остановка сервера одной кнопкой
- Просмотр статуса и статистики в реальном времени
- История последних печатей
- Помощник установки расширения браузера
- Просмотр логов
- Открытие веб-панели управления

## Создание EXE-файла (не требует Python)

Для распространения программы без необходимости установки Python:

1. У вас должен быть установлен Python
2. Запустите `СОЗДАТЬ_EXE.bat`
3. EXE-файл будет создан в папке `dist`
4. Скопируйте папку `dist` пользователю

**ВАЖНО:** 
- EXE работает только на Windows
- Пользователю нужно установить расширение браузера отдельно (запустите `УСТАНОВИТЬ_РАСШИРЕНИЕ.bat`)

## Документация

- **`ПОЛНАЯ_ИНСТРУКЦИЯ.md`** ⭐ - **ДЕТАЛЬНАЯ ПОШАГОВАЯ ИНСТРУКЦИЯ** от установки Python до первого использования (рекомендуется для новичков)
- **`ИНСТРУКЦИЯ_WINDOWS.md`** - краткая инструкция по установке и запуску на Windows
- **`ЛОГИКА_РАБОТЫ.md`** - подробное описание логики работы приложения и сравнение с аналогами

## Автоматическая установка расширения

Для упрощения установки расширения браузера:

- Windows: `УСТАНОВИТЬ_РАСШИРЕНИЕ.bat`
- Mac/Linux: `./УСТАНОВИТЬ_РАСШИРЕНИЕ.sh`

Скрипт автоматически:
- Откроет страницы расширений в браузерах
- Покажет путь к папке `extension`
- Проведет через процесс установки
